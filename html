<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>AAI Proficiency Check Form</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      padding-bottom: 50px;
    }
    .top-left-logo {
      position: absolute;
      top: 20px;
      left: 20px;
      width: 100px;
    }
    h2 {
      text-align: center;
      margin-top: 20px;
    }
    table, th, td {
      border: 1px solid black;
      border-collapse: collapse;
    }
    th, td {
      padding: 6px;
      text-align: left;
    }
    button {
      margin: 6px;
      padding: 6px 12px;
    }
    textarea {
      width: 100%;
      border: none;
      border-bottom: 1px solid black;
      resize: vertical;
    }

    input[type="text"],
    input[type="date"] {
      border: none;
      border-bottom: 1px solid black;
      outline: none;
      padding: 2px 4px;
      width: 180px;
    }

    label {
      display: inline-block;
      margin: 6px 0;
    }

    fieldset {
      margin-bottom: 16px;
    }

    .signature-section {
      margin-top: 60px;
    }

    .signature-block {
      margin-bottom: 60px;
    }

    .signature-title {
      font-weight: bold;
      margin-bottom: 10px;
    }

    .signature-line {
      margin-bottom: 20px;
    }

    @media print {
      .no-print {
        display: none;
      }
      .page-break {
        page-break-before: always;
      }
    }
  </style>
</head>
<body>

<img src="aai.png" alt="AAI Logo" class="top-left-logo">

<h2>Airports Authority of India<br>Proficiency Check Proforma</h2>

<form id="proficiencyForm">
  <label>Airport: <input type="text" name="airport"></label> &nbsp;
  <label>Unit: <input type="text" name="unit"></label> &nbsp;
  <label>Date: <input type="date" name="date"></label> &nbsp;
  <label>Period: <input type="text" name="period"></label><br><br>

  <fieldset>
    <legend>Controller Details</legend>
    Name: <input type="text" name="controller_name">
    Designation: <input type="text" name="controller_designation"><br>
    License No: <input type="text" name="controller_license">
    License Validity: <input type="date" name="license_validity">
    Medical Validity: <input type="date" name="medical_validity">
  </fieldset>

  <fieldset>
    <legend>Examiner Details</legend>
    Name: <input type="text" name="examiner_name">
    Designation: <input type="text" name="examiner_designation"><br>
    License No: <input type="text" name="examiner_license">
    License Validity: <input type="date" name="examiner_license_validity">
    Medical Validity: <input type="date" name="examiner_medical_validity">
  </fieldset>

  <h3>Performance Evaluation (Grade 1 to 5)</h3>
  <table>
    <thead>
      <tr>
        <th>S.N.</th>
        <th>Performance Identifier</th>
        <th>Grade</th>
      </tr>
    </thead>
    <tbody id="gradesTable"></tbody>
  </table>

  <div class="no-print">
    <button type="button" onclick="calculate()">üéØ Calculate</button>
    <button type="button" onclick="saveForm()">üíæ Save</button>
    <button type="button" onclick="sendEmail()">üìß Email</button>
    <button type="button" onclick="downloadPDF()">‚¨á Download PDF</button>
    <button type="button" onclick="window.print()">üñ®Ô∏è Print</button>
    <button type="button" onclick="clearForm()">üßπ Clear All</button>
  </div>

  <div class="page-break"></div>

  <label>Marks Obtained: <input type="text" id="marks" readonly></label><br>
  <label>Percentage: <input type="text" id="percentage" readonly></label><br>

  <label><input type="checkbox" id="proficiency"> Demonstrated Proficiency</label><br>
  <label><input type="checkbox" id="notProficient"> Did not demonstrate Proficiency</label><br><br>

  <label>Remarks:<br>
    <textarea rows="4" name="remarks"></textarea>
  </label><br><br>

  <!-- Signature Section -->
  <div class="signature-section">
    <h3>Signatures</h3>

    <div class="signature-block">
      <div class="signature-title">Chairman / Assessor</div>
      <div class="signature-line">Signature: <input type="text" name="chairman_signature"></div>
      <div>Name: <input type="text" name="chairman_name"></div>
      <div>Designation: <input type="text" name="chairman_designation"></div>
    </div>

    <div class="signature-block">
      <div class="signature-title">Member 1</div>
      <div class="signature-line">Signature: <input type="text" name="member1_signature"></div>
      <div>Name: <input type="text" name="member1_name"></div>
      <div>Designation: <input type="text" name="member1_designation"></div>
    </div>

    <div class="signature-block">
      <div class="signature-title">Member 2</div>
      <div class="signature-line">Signature: <input type="text" name="member2_signature"></div>
      <div>Name: <input type="text" name="member2_name"></div>
      <div>Designation: <input type="text" name="member2_designation"></div>
    </div>

    <div class="signature-block">
      <div class="signature-title">Assessee</div>
      <div class="signature-line">Signature: <input type="text" name="assessee_signature"></div>
      <div>Name: <input type="text" name="assessee_name"></div>
      <div>Designation: <input type="text" name="assessee_designation"></div>
    </div>
  </div>
</form>

<script>
  const items = [
    "Impending conflicting traffic detected and resolved",
    "The applied separation between aircraft, aircraft on the maneuvering area & obstructions on that area , is appropriate taking into account safety & efficiency",
    "Traffic planned appropriate manner with least average delay taking into account SOPs, trffic situation, runway in use, taxi routing destination aerodrome/route and performance characteristics.",
    "Maintained safe and orderly traffic flow with least average delay",
    "Maintained surveillance visually or via tools",
    "Used correct phraseologies",
    "Instructions were concise and unambiguous and used coreect rate of speech and radiotelephony technique.",
    "Used correct call signs, monitored read-backs and errors corrected quickly.",
    "Coordinated with other ATC units/agencies performed effectively and in English",
    "Initiated and accepted transfer of control/communication promptly",
    "Promptly updated data on FDP/A-SMGCS/FPS/EFS or paased required information to concerned ATC Unit as per publushed procedure.",
    "Acknowledge and Monitored all alerts alarms on A-SMGCS and/or by other agencies and took appropriate action.",
    "Maintained situational awareness at all times and Scanned the area of jurisdiction effectively.",
    "Shifted attention between various aircraft and vehicles as required and prioritized activities according to situation.",
    "Stayed calm, focused and handled workload efficiently.",
    "Handled unexpected situations effectively.",
    "Selected runway in use and appropriate visual and non-visual aids & facilities.",
    "Took appropriate action upon significant changes in meteorological conditions/ essential information.",
    "Responded to pilot's requests promptly.",
    "Exhibited team member attributes and adapted to unusual situation occuring in other unit.",
    "Received and gave complete position relief briefing.",
    "Application of Separation Standards.",
    "Equipment/Tools/displays available in the unit/working position, knowledge of Airspace/Aerodrome Data/IAL Procedured/Visual signals/VFR & SVFR/ Aircraft Performance and characteristics.",
    "Source of information(Awareness/Knowledge of relevant documents such as ICAO Docs, Aerodrome Manual, contingency/emergency plans and procedures, Docs Issued by DGCA/AAI,AIPs,NOTAMs etc.)",
    "Unusual Occurrences and contigency procedures."
  ];

  const tableBody = document.getElementById("gradesTable");
  items.forEach((item, i) => {
    const row = document.createElement("tr");
    row.innerHTML = `
      <td>${i + 1}</td>
      <td>${item}</td>
      <td>
        <select name="grade${i + 1}" class="grade">
          <option value="5">5</option>
          <option value="4">4</option>
          <option value="3">3</option>
          <option value="2">2</option>
          <option value="1">1</option>
        </select>
      </td>`;
    tableBody.appendChild(row);
  });

  function calculate() {
    const grades = document.querySelectorAll('.grade');
    let total = 0;
    grades.forEach(g => total += parseInt(g.value));
    document.getElementById('marks').value = total;
    const percentage = (total / (grades.length * 5)) * 100;
    document.getElementById('percentage').value = percentage.toFixed(2) + "%";
    document.getElementById('proficiency').checked = percentage >= 80;
    document.getElementById('notProficient').checked = percentage < 80;
  }

  function saveForm() {
    const form = new FormData(document.getElementById("proficiencyForm"));
    let data = {};
    form.forEach((value, key) => data[key] = value);
    localStorage.setItem("proficiencyData", JSON.stringify(data));
    alert("‚úÖ Form saved in browser (local storage)");
  }

  function sendEmail() {
    const form = new FormData(document.getElementById("proficiencyForm"));
    let body = "";
    form.forEach((value, key) => body += `${key}: ${value}\n`);
    const mailtoLink = `mailto:someone@example.com?subject=AAI Proficiency Check&body=${encodeURIComponent(body)}`;
    window.location.href = mailtoLink;
  }

  async function downloadPDF() {
    const { jsPDF } = window.jspdf;
    const doc = new jsPDF({ unit: 'mm', format: 'a4' });
    const form = document.getElementById("proficiencyForm");
    const clone = form.cloneNode(true);
    clone.querySelectorAll('.no-print').forEach(el => el.remove());
    const html = clone.innerHTML;
    doc.setFontSize(10);
    doc.text(html, 10, 10); // Placeholder
    doc.save("AAI-Proficiency-Form.pdf");
  }

  function clearForm() {
    localStorage.removeItem("proficiencyData");
    document.getElementById("proficiencyForm").reset();
    document.getElementById("marks").value = "";
    document.getElementById("percentage").value = "";
    document.getElementById("proficiency").checked = false;
    document.getElementById("notProficient").checked = false;
    alert("üßπ Form cleared");
  }

  window.onload = function () {
    const saved = localStorage.getItem("proficiencyData");
    if (saved) {
      const data = JSON.parse(saved);
      for (let key in data) {
        const field = document.querySelector(`[name="${key}"]`);
        if (field) field.value = data[key];
      }
    }
  }
</script>

</body>
</html>
